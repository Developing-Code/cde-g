<%- include('./partials/nav.ejs') %>


  <style>
    .login {
      background-color: rgb(238, 238, 238);
      background-repeat: no-repeat;
      background-size: cover;
      background-attachment: fixed;
      background-position: center center;


    }

    .listaUsuarios {

      background-repeat: no-repeat;
      background-size: cover;
      background-attachment: fixed;
      background-position: center center;

    }

    h5 {
      color: rgb(94, 93, 93);
    }
  </style>

  <body class="login">



    <div class="container" style="margin-top: 150px; color: rgb(128, 128, 128); "> 
      <div class="row justify-content-center mt-5 ">
        <div class=" col-lg-9 col-md-12 col-sm-12">
          <div class="card">
            <div class="card-title text-center border-bottom">
              <h2 class="p-3">Agregar nueva compostera</h2>
            </div>
            <div class="card-body">

              <form action="/agregarNuevocomposterasSend" method="POST" enctype="multipart/form-data">
                <div class="container ">
                  <div class="row justify-content-evenly">



                    <div class="col-lg-12 col-sm-12">
                      <div class="form-group mb-3">
                        <label for="fecha_entrega">Fecha Entrega</label>
                        <input type="date" class="form-control" id="fecha_entrega" name="fecha_entrega" required>
                      </div>

                      <input type="hidden" value="<%= ID%>" name="id_quienEntrega" required>
                      <input type="hidden" value="<%= name%>" name="nombre_quienEntrega" required>

                      <div class="form-group mb-3">
                        <label for="codBenefic">Código Beneficiario</label>
                        <input type="text" class="form-control" id="codBenefic" name="codBenefic" required
                          oninput="checkcodBenefic()">
                        <div id="validation-message"></div>
                      </div>

                      <div class="form-group mb-3">
                        <label for="nombreInstitucion">Nombre de entidad</label>
                        <input type="text" class="form-control" id="nombreInstitucion" name="nombreInstitucion">
                      </div>

                      <div class="form-group mb-3">
                        <label for="nombreResponsable">Nombre Responsable</label>
                        <input type="text" class="form-control" id="nombreResponsable" name="nombreResponsable">
                      </div>

                      <div class="form-group mb-3">
                        <label for="celularResponsable">Celular/Contacto</label>
                        <input type="tel" class="form-control" id="celularInput" name="celularResponsable">
                      </div>

                      <div class="form-group mb-3">
                        <label for="identificacionResponsable">Identificación</label>
                        <div class="row">
                          <div class="col-3">
                            <select class="form-control" id="tipoIdentifi" name="tipoIdentifi">
                              <option value="CC" selected>Cédula de Ciudadanía (CC)</option>
                              <option value="NIT">Número de Identificación Tributaria (NIT)</option>
                              <option value="TI">Tarjeta de Identidad (TI)</option>
                            </select>
                          </div>
                          <div class="col-9">
                            <input type="number" class="form-control" id="identificacionResponsable"
                              name="identificacionResponsable" required>
                          </div>
                        </div>
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="email">Correo electrónico</label>
                        <input type="email" class="form-control" id="email" name="email">
                      </div>

                      <div class="form-group mb-3">
                        <label for="usuario">Tipo beneficiario</label>
                        <select class="form-control" id="notaCompostera" name="notaCompostera">
                          <option value="Colegio" selected>Colegio</option>
                          <option value="Huerta">Huerta</option>
                          <option value="Universidad">Universidad</option>
                          <option value="Propiedad Horizontal">Propiedad Horizontal</option>
                          <option value="Institucional">Institucional</option>
                          <option value="centro comercial">Centro comercial</option>
                        </select>
                      </div>

                      <div class="form-group mb-3">
                        <label for="capacidadCompostera">Capacidad Compostera</label>
                        <select class="form-control" id="capacidadCompostera" name="capacidadCompostera">
                          <option value="20" selected>20 kg/día</option>
                          <option value="40">40 kg/día</option>
                          <option value="60">60 kg/día</option>
                        </select>
                      </div>
                    </div>




                    <div class="col-lg-12 col-sm-12">
                      <div class="form-group mb-3">
                        <label for="direccionInstitucion">Dirección</label>
                        <div class="row mb-3">
                          <div class="col-md-4 mt-3">
                            <select class="form-control" id="Ciudad" name="Ciudad">
                              <option value="Bogotá" selected>Bogotá</option>
                              <option value="Medellín">Medellín</option>
                              <option value="Cali">Cali</option>
                              <option value="Barranquilla">Barranquilla</option>
                              <option value="Cartagena">Cartagena</option>
                            </select>
                          </div>
                          <div class="col-md-4 mt-3">
                            <select class="form-control" id="Localidad" name="Localidad">
                              <option value="Localidad" selected>Localidad</option>
                              <option value="Localidad" selected >Localidad</option>
                              <option value="Usaquén" >Usaquén</option>
                              <option value="Chapinero" >Chapinero</option>
                              <option value="Santa Fe">Santa Fe</option>
                              <option value="San Cristóbal">San Cristóbal</option>
                              <option value="Usme" >Usme</option>
                              <option value="Tunjuelito" >Tunjuelito</option>
                              <option value="Bosa" >Bosa</option>
                              <option value="Kennedy">Kennedy</option>
                              <option value="Fontibón" >Fontibón</option>
                              <option value="Engativá">Engativá</option>
                              <option value="Suba" >Suba</option>
                              <option value="Barrios Unidos" >Barrios Unidos</option>
                              <option value="Teusaquillo">Teusaquillo</option>
                              <option value="Los Mártires" >Los Mártires</option>
                              <option value="Antonio Nariño">Antonio Nariño</option>
                              <option value="Puente Aranda" >Puente Aranda</option>
                              <option value="La Candelaria" >La Candelaria</option>
                              <option value="Rafael Uribe Uribe" >Rafael Uribe Uribe</option>
                              <option value="Ciudad Bolívar" >Ciudad Bolívar</option>
                              <option value="Sumapaz" >Sumapaz</option>
                              <option value="Usaquén">Usaquén</option>
                              <option value="Chapinero">Chapinero</option>
                            </select>
                          </div>
                          <div class="col-md-4 mt-3">
                            <input type="text" class="form-control" id="Barrio" name="Barrio" placeholder="Barrio">
                          </div>
                        </div>
                        <input class="form-control" id="address" name="direccionInstitucion"
                          placeholder="Ingresa una dirección">
                        <div id="suggestions"></div>
                      </div>

                      <div class="form-group mb-3" hidden>
                        <label for="coordenadas">Coordenadas de la ubicación</label>
                        <div class="row mb-3">
                          <div class="col-md-4">
                            <input type="text" class="form-control" id="latloguser" name="coordenadas" value="0">
                          </div>
                          <div class="col-md-4">
                            <input type="text" class="form-control" id="lat" name="lat" value="0" hidden>
                          </div>
                          <div class="col-md-4">
                            <input type="text" class="form-control" id="log" name="log" value="0" hidden>
                          </div>
                        </div>
                        <br>
                        <div id="map"></div>
                      </div>

                      <input type="text" class="form-control" name="estado" value="INCOMPLETO" hidden>

                    </div>

                  </div>
                  <div class="row">
                    <input type="text" value="" name="id" hidden>

                    <div class="mb-3">
                      <input class="form-check-input" type="checkbox" id="uploadSwitch" onchange="toggleUpload()">
                      <label for="uploadSwitch">Subir imagen de la compostera</label>
                      <input type="file" id="fileInput" class="form-control" name="evidencia_foto" disabled>
                    </div>

                  </div>
                </div>





                <div class="d-grid">
                  <button type="submit" class="btn btn-success">Continuar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <% if(typeof alert !="undefined" ) { %>
      <script>
        Swal.fire({
          title: '<%=alertTitle %>',
          text: '<%= alertMessage%>',
          icon: '<%=alertIcon %>',
          showConfirmButton: '<%= showConfirmButton %>',
          timer: '<%= timer %>'
        }).then(() => {
          window.location = '/<%= ruta %>'
        })
      </script>
      <% } %>
        <script>
          var inputs = $("input[type=text]");
          for (var i = 0; i < inputs.length; i++) {
            var aux = $(inputs[i]).val().trim();
            $(inputs[i]).val(aux);
          }
        </script>

        <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>



        <script>
          $(document).ready(function () {

            var now = new Date();

            var day = ("0" + now.getDate()).slice(-2);
            var month = ("0" + (now.getMonth() + 1)).slice(-2);
            var hour = (now.getHours() < 10 ? '0' : '') + now.getHours() + ":" + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();

            var today = now.getFullYear() + "-" + (month) + "-" + (day);
            $("#fecha").val(today);
            $("#hora").val(hour);
          });

          function toggleUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadSwitch = document.getElementById('uploadSwitch');
            fileInput.disabled = !uploadSwitch.checked;
          }


          const celularInput = document.getElementById('celularInput');

          // Agrega un oyente para el evento 'input'
          celularInput.addEventListener('input', function () {
            // Obtén el valor actual del input
            let valor = celularInput.value;

            // Elimina cualquier carácter que no sea un número, coma o guion
            valor = valor.replace(/[^0-9,-]/g, '');

            // Actualiza el valor del input
            celularInput.value = valor;
          });
        </script>
        <script>
          async function checkcodBenefic() {
            let timeoutId;

            const inputElement = document.getElementById("codBenefic");
            const validationMessage = document.getElementById("validation-message");
            const codBenefic = inputElement.value.trim();

            if (codBenefic === "") {
              inputElement.style.borderColor = "";
              validationMessage.innerText = "";
              return;
            }
            // Cancelar el temporizador anterior si existe
            clearTimeout(timeoutId);
            timeoutId = setTimeout(async () => {
              try {
                const response = await fetch(`/checkcodBenefic?codBenefic=${codBenefic}`);
                const data = await response.json();

                if (data.exists) {
                  inputElement.style.borderColor = "red";
                  validationMessage.innerText = "¡El beneficiario ya ha sido registrado!";
                } else {
                  inputElement.style.borderColor = "green";
                  validationMessage.innerText = "beneficiario disponible.";
                }
              } catch (error) {
                console.error(error);
              }
            }, 500);
          }
        </script>

        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
          integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
          crossorigin=""></script>

        <script src="/js/scriptsMap.js"></script>
        <%- include('./partials/footer.ejs') %>
  </body>

  </html>