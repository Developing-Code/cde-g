<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.2.3/css/fixedHeader.dataTables.min.css">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">



<%- include('./partials/nav.ejs') %>
  <style>
    .btn-morado1 {
      color: #ffffff;
      background-color: #453D81;
      border-color: #453D81;
    }
  </style>
  <style>
    .btn-morado1 {
      color: #fff;
      background-color: #453D81;
      border-color: #453D81;
    }

    .btn-morado1:hover {
      color: #fff;
      background-color: #5214a1;
      border-color: #5214a1;
    }

    .btn-morado1:focus,
    .btn-morado1.focus {
      box-shadow: 0 0 0 0.2rem rgba(25, 0, 255, 0.5);
    }

    tfoot input {
      width: 100%;
      padding: 3px;
      box-sizing: border-box;
    }


    .border-left-primary {
      border-left: 0.25rem solid #4e73df !important;
    }

    .border-bottom-primary {
      border-bottom: 0.25rem solid #4e73df !important;
    }

    .border-left-secondary {
      border-left: 0.25rem solid #858796 !important;
    }

    .border-bottom-secondary {
      border-bottom: 0.25rem solid #858796 !important;
    }

    .border-left-success {
      border-left: 0.25rem solid #1cc88a !important;
    }

    .border-bottom-success {
      border-bottom: 0.25rem solid #1cc88a !important;
    }

    .border-left-info {
      border-left: 0.25rem solid #36b9cc !important;
    }

    .border-bottom-info {
      border-bottom: 0.25rem solid #36b9cc !important;
    }

    .border-left-warning {
      border-left: 0.25rem solid #f6c23e !important;
    }

    .border-bottom-warning {
      border-bottom: 0.25rem solid #f6c23e !important;
    }

    .border-left-danger {
      border-left: 0.25rem solid #e74a3b !important;
    }

    .border-bottom-danger {
      border-bottom: 0.25rem solid #e74a3b !important;
    }

    .border-left-light {
      border-left: 0.25rem solid #f8f9fc !important;
    }

    .border-bottom-light {
      border-bottom: 0.25rem solid #f8f9fc !important;
    }

    .border-left-dark {
      border-left: 0.25rem solid #5a5c69 !important;
    }

    .border-bottom-dark {
      border-bottom: 0.25rem solid #5a5c69 !important;
    }
  </style>
  </head>




  <body style="font-size: 15px">

    <div class="container-fluid " style="margin-top: 150px; text-align: center">

      <div class="row">
        <div class="col-12">
          <div class="card shadow border-0">
            <h5 class="card-header border-0 text-center text-light"
              style="border-radius: 22px 22px 0px 0px;background-color:#E76E09">Filtrar</h5>
            <div class="card-body">
              
             
              <form action="/filtrarregistrosOperacionsend" method="POST">
                <div class="row ">
                  <div class="col-md-12 col-sm-12 col-lg-3">
                    <div class="input-group mb-3">
                      <span class="input-group-text">Fecha Inicial: </span>
                      <input type="date" class="form-control" id="fecha_inicial" name="fecha_inicial" >
                      <span class="input-group-text">Fecha Final: </span>
                      <input type="date" class="form-control" id="fecha_final" name="fecha_final" >
                    </div>
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-3">
                    <div class="input-group mb-3">
                      <span class="input-group-text">Beneficiario</span>
                      <select class="form-select" aria-label="Default select example" name="beneficiario">
                        <option value="todos" selected>Todos</option>
                        <% resltCompost.forEach((coms)=> {%>
                          <option value="<%= coms.id_compostera %>">
                            <%= coms.codBenefic_compostera %> - <%= coms.nombre_responsable%>
                          </option>
                          <% }) %>
                      </select>

                    </div>
                  </div>



                </div>
                <hr>
                <div class="row">
                  <div class="col-md-12 col-sm-12 col-lg-2">
                    <label for="">Supervisor</label>
                    <select class="form-select" aria-label="Default select example" name="supervisor" id="supervisor">
                      <option value="todos" selected>Todos</option>
                      <% resSupervisores.forEach((usrs)=> {%>
                        <option value="<%= usrs.id_quienRegistra %>">
                          <%= usrs.id_quienRegistra %> - <%= usrs.nombre_usuario %>
                        </option>
                        <% }) %>
                    </select>
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-2">
                    <label for="">Estado Compostera</label>
                    <select class="form-select" aria-label="Default select example" name="estadoCompostera" title="Necesitas seleccionar fechas ">
                      <option value="todos" selected>Todos</option>
                      <option value="activa">Activas</option>
                      <option value="inactivas">Inactivas</option>

                    </select>
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-2">
                    
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-2">
                    
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-2">
                   
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-2">
                    <button type="submit" class="btn btn-primary">Filtrar</button>
                  </div>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>

      <% if ( statsData) {%>
        <div class="row mt-5"> <!-- Total -->
          <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1"> <strong>Total
                        registros</strong>
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                  <%= totalRegistros[0].total_registros %>
                    </div>
                  </div>
                  <div class="col-auto">
                    <i class="fas fa-calendar fa-2x text-gray-300"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Earnings (Monthly) Card Example -->
          <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                      <strong>Registros activos</strong>
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                      <%= activosRegistros[0].total_composteras_activas%>
                    </div>
                  </div>
                  <div class="col-auto">
                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                      <strong>Registros Inactivos</strong>
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                      <%=inactivas %>
                    </div>
                  </div>
                  <div class="col-auto">
                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

         

          <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-darnger shadow h-100 py-2">
              <div class="card-body">
                <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1"> <strong>Registros </strong>
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">

                    </div>
                  </div>
                  <div class="col-auto">
                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>




        </div>
        <% } %>
        <% if ( statsData2) {%>
          <div class="row mt-5"> <!-- Total -->
            <div class="col-xl-3 col-md-6 mb-4">
              <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1"> <strong>Total
                          registros</strong>
                      </div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">
                    <%= totalRegistros %>
                      </div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
  
  
  
          </div>
          <% } %>

          <% if ( role=='admin' || role=='supervisor' ) {%>
            <div class="container-fluid" >
              <div class="row">
                <div class="col-12">
                  <table id="users" class="table  dt-responsive nowrap table  table-hover table-bordered"
                    style="font-size: 14px; width: 100%;">
                    <thead>
                      <tr>
                        <th>id registro</th>
                        <th>Codigo beneficiario</th>
                        <th>Fecha</th>
                        <th>Tipo registro</th>
                        <th>Supervisor</th>
                        <th>Clima</th>
                        <th>Temperatura</th>
                        <th>Humedad</th>
                        <th>Insectos</th>
                        <th>Roedores</th>
                        <th>Presencia lixiviados</th>
                        <th>Cnt Material estructurante</th>
                        <th>Cnt Material organico</th>
                        <th>Cnt Producto</th>
                        
                        <th>Acciones</th>
                      </tr>
                    </thead>

                    <tbody>
                      <% results.forEach((data1)=> {%>


                        <tr>
                          <td>
                            <%= data1.id %>
                          </td>
                          <td>
                            <%= data1.codBenefic_compostera %>
                          </td>
                          <td>
                            <%= data1.fecha_registro %>
                          </td>
                          <td>
                            <%= data1.TipoRegistro %>
                          </td>
                          <td>
                            <%= data1.nombre_usuario %>
                          </td>
                          <td>
                            <%= data1.clima %>
                          </td>
                          <td>
                            <%= data1.temperatura %> C
                          </td>
                          <td>
                            <%= data1.humedad %> %
                          </td>
                          <td>
                            <%= data1.Pinsectos %>
                          </td>
                          <td>
                            <%= data1.Proedores %>
                          </td>
                          <td>
                            <%= data1.prelixiviados %>
                          </td>
                          <td>
                            <%= data1.CantidadME %> kg
                          </td>
                          <td>
                            <%= data1.CantidadMO %> kg
                          </td>
                          <td>
                            <%= data1.cantidadCompost %>
                          </td>
                          
                          <td>
                            <a href="/detallesRegitroOperacion/<%= data1.id %>" title="Detalles"
                              class="btn btn-sm btn-morado1" type="button"><i
                                class='bx bx-dots-vertical-rounded'></i></a>
                            <a href="/imprimirRegitroOperacion/<%= data1.id %>" title="Imprimir reporte"
                              class="btn btn-sm btn-morado1" type="button"><i class='bx bxs-printer'></i></a>

                            <!-- <a href="/registerUsersDelate/" class="btn btn-danger" type="button"><i class='bx bxs-trash' ></i></a> -->
                            <a onclick="alertDelate('<%= data1.id %>')" class="btn btn-sm btn-danger" type="button"><i
                                class='bx bxs-trash'></i></a>
                          </td>
                        </tr>
                        <% }) %>
                    </tbody>
                  </table>
                </div>


              </div>
            </div>
            <% } %>


    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.2.3/js/dataTables.fixedHeader.min.js"></script>

    <script src="js/bootstrap-datepicker.min.js"></script>
    <script>

      $('.input-daterange').datepicker({
        keyboardNavigation: false,
        forceParse: false,
        autoclose: true,
        language: "es",
        orientation: "bottom auto",
        todayHighlight: true,
        format: 'yyyy-mm-dd'
      });

    </script>
    <script>
      $(document).ready(function () {



        var table = $('#users').DataTable({
          initComplete: function () {
            this.api()
              .columns()
              .every(function () {
                let column = this;
                let title = column.footer().textContent;

                // Create input element
                let input = document.createElement('input');
                input.placeholder = title;
                column.footer().replaceChildren(input);

                // Event listener for user input
                input.addEventListener('keyup', () => {
                  if (column.search() !== this.value) {
                    column.search(input.value).draw();
                  }
                });
              });
          },
          fixedHeader: true,
          order: [[0, 'desc']],
          scrollX: true,
          searching: true,
          dom: 'Bfrtip',
          buttons: [],
          pageLength: 10,
          language: {
            search: 'Buscar',
            zeroRecords: 'No hay registros para mostrar.',
            emptyTable: 'La tabla está vaciá.',
            info: "Mostrando _START_ de _END_ de _TOTAL_ Registros.",
            infoFiltered: "(Filtrados de _MAX_ Registros.)",
            paginate: {
              first: 'Primero',
              previous: 'Anterior',
              next: 'Siguiente',
              last: 'Último'
            }
          },
          columnDefs: [
            {
              target: 2,
              visible: false,
              searchable: false
            },
            {
              target: 3,
              visible: false
            }
          ]
        });






      });



    

    </script>



    <script>
      function alertDelate(id) {
        Swal.fire({
          title: '¿Quieres eliminar este usuario?',
          icon: 'warning',
          showCancelButton: true,
          cancelButtonText: 'NO',
          cancelButtonColor: '#d33',
          confirmButtonColor: '#3085d6',
          confirmButtonText: ` SI `,
        }).then((result) => {
          /* Read more about isConfirmed, isDenied below */
          if (result.isConfirmed) {
            Swal.fire('Compostera eliminada exitosamente', '', 'success', 1500)
            const value = true
            setTimeout(timeUot, 2000, value, id);
          }
        })
      }
      function timeUot(values, id) {
        if (values) {
          window.location = '/delatecompostera/' + id
        }

      }
    </script>





    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"></script>

    <%- include('./partials/footer.ejs') %>
  </body>

  </html>